import { ActionIcon, Center, Group } from "@mantine/core";
import { getCurrentWebviewWindow } from "@tauri-apps/api/webviewWindow";
import React, { type JSX, type SVGProps, useEffect, useState } from "react";
import { env } from "@/utils/detectEnvironment";
import * as classes from "./WindowControls.css";

const appWindow = env.isDesktop() ? getCurrentWebviewWindow() : null;

const Icons = {
  minimizeWin: (props: JSX.IntrinsicAttributes & SVGProps<SVGSVGElement>) => (
    <svg width="10" height="1" viewBox="0 0 10 1" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <title>Minimize Window</title>
      <path
        d="M0.498047 1.00098C0.429688 1.00098 0.364583 0.987956 0.302734 0.961914C0.244141 0.935872 0.192057 0.900065 0.146484 0.854492C0.100911 0.808919 0.0651042 0.756836 0.0390625 0.698242C0.0130208 0.636393 0 0.571289 0 0.50293C0 0.43457 0.0130208 0.371094 0.0390625 0.3125C0.0651042 0.250651 0.100911 0.19694 0.146484 0.151367C0.192057 0.102539 0.244141 0.0651042 0.302734 0.0390625C0.364583 0.0130208 0.429688 0 0.498047 0H9.50195C9.57031 0 9.63379 0.0130208 9.69238 0.0390625C9.75423 0.0651042 9.80794 0.102539 9.85352 0.151367C9.89909 0.19694 9.9349 0.250651 9.96094 0.3125C9.98698 0.371094 10 0.43457 10 0.50293C10 0.571289 9.98698 0.636393 9.96094 0.698242C9.9349 0.756836 9.89909 0.808919 9.85352 0.854492C9.80794 0.900065 9.75423 0.935872 9.69238 0.961914C9.63379 0.987956 9.57031 1.00098 9.50195 1.00098H0.498047Z"
        fill="currentColor"
        fillOpacity="0.8956"
      />
    </svg>
  ),
  maximizeWin: (props: JSX.IntrinsicAttributes & SVGProps<SVGSVGElement>) => (
    <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <title>Maximize Window</title>
      <path
        d="M1.47461 10.001C1.2793 10.001 1.09212 9.96191 0.913086 9.88379C0.734049 9.80241 0.576172 9.69499 0.439453 9.56152C0.30599 9.4248 0.198568 9.26693 0.117188 9.08789C0.0390625 8.90885 0 8.72168 0 8.52637V1.47559C0 1.28027 0.0390625 1.0931 0.117188 0.914062C0.198568 0.735026 0.30599 0.578776 0.439453 0.445312C0.576172 0.308594 0.734049 0.201172 0.913086 0.123047C1.09212 0.0416667 1.2793 0.000976562 1.47461 0.000976562H8.52539C8.7207 0.000976562 8.90788 0.0416667 9.08691 0.123047C9.26595 0.201172 9.4222 0.308594 9.55566 0.445312C9.69238 0.578776 9.7998 0.735026 9.87793 0.914062C9.95931 1.0931 10 1.28027 10 1.47559V8.52637C10 8.72168 9.95931 8.90885 9.87793 9.08789C9.7998 9.26693 9.69238 9.4248 9.55566 9.56152C9.4222 9.69499 9.26595 9.80241 9.08691 9.88379C8.90788 9.96191 8.7207 10.001 8.52539 10.001H1.47461ZM8.50098 9C8.56934 9 8.63281 8.98698 8.69141 8.96094C8.75326 8.9349 8.80697 8.89909 8.85254 8.85352C8.89811 8.80794 8.93392 8.75586 8.95996 8.69727C8.986 8.63542 8.99902 8.57031 8.99902 8.50195V1.5C8.99902 1.43164 8.986 1.36816 8.95996 1.30957C8.93392 1.24772 8.89811 1.19401 8.85254 1.14844C8.80697 1.10286 8.75326 1.06706 8.69141 1.04102C8.63281 1.01497 8.56934 1.00195 8.50098 1.00195H1.49902C1.43066 1.00195 1.36556 1.01497 1.30371 1.04102C1.24512 1.06706 1.19303 1.10286 1.14746 1.14844C1.10189 1.19401 1.06608 1.24772 1.04004 1.30957C1.014 1.36816 1.00098 1.43164 1.00098 1.5V8.50195C1.00098 8.57031 1.014 8.63542 1.04004 8.69727C1.06608 8.75586 1.10189 8.80794 1.14746 8.85352C1.19303 8.89909 1.24512 8.9349 1.30371 8.96094C1.36556 8.98698 1.43066 9 1.49902 9H8.50098Z"
        fill="currentColor"
        fillOpacity="0.8956"
      />
    </svg>
  ),
  maximizeRestoreWin: (props: JSX.IntrinsicAttributes & SVGProps<SVGSVGElement>) => (
    <svg width="10" height="11" viewBox="0 0 10 11" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <title>Maximize/Restore Window</title>
      <path
        d="M8.99902 2.98096C8.99902 2.71077 8.94531 2.45687 8.83789 2.21924C8.73047 1.97835 8.58398 1.77002 8.39844 1.59424C8.21615 1.4152 8.00293 1.27523 7.75879 1.17432C7.5179 1.07015 7.264 1.01807 6.99707 1.01807H2.08496C2.13704 0.868327 2.21029 0.731608 2.30469 0.60791C2.39909 0.484212 2.50814 0.378418 2.63184 0.290527C2.75553 0.202637 2.89062 0.135905 3.03711 0.090332C3.18685 0.0415039 3.34147 0.0170898 3.50098 0.0170898H7.02441C7.21973 0.0170898 7.4069 0.0561523 7.58594 0.134277C7.76497 0.212402 7.92285 0.319824 8.05957 0.456543C8.19629 0.590007 8.30371 0.746257 8.38184 0.925293C8.45996 1.10433 8.49902 1.2915 8.49902 1.48682V2.98096H8.99902ZM1.5 11C1.30469 11 1.11751 10.961 0.938477 10.8828C0.75944 10.8014 0.601562 10.694 0.464844 10.5605C0.33138 10.4238 0.223958 10.266 0.142578 10.0869C0.0644531 9.90788 0.0253906 9.7207 0.0253906 9.52539V2.97461C0.0253906 2.7793 0.0644531 2.59212 0.142578 2.41309C0.223958 2.23405 0.33138 2.0778 0.464844 1.94434C0.601562 1.80762 0.75944 1.7002 0.938477 1.62207C1.11751 1.54069 1.30469 1.5 1.5 1.5H8C8.19531 1.5 8.38249 1.54069 8.56152 1.62207C8.74056 1.7002 8.89681 1.80762 9.03027 1.94434C9.16699 2.0778 9.27441 2.23405 9.35254 2.41309C9.43392 2.59212 9.47461 2.7793 9.47461 2.97461V9.52539C9.47461 9.7207 9.43392 9.90788 9.35254 10.0869C9.27441 10.266 9.16699 10.4238 9.03027 10.5605C8.89681 10.694 8.74056 10.8014 8.56152 10.8828C8.38249 10.961 8.19531 11 8 11H1.5ZM7.97559 9.99902C8.04395 9.99902 8.10807 9.98599 8.16797 9.95996C8.22982 9.93392 8.28223 9.89811 8.3252 9.85254C8.37077 9.80957 8.40658 9.75749 8.43262 9.69629C8.45866 9.63444 8.47168 9.56934 8.47168 9.50098V3C8.47168 2.93164 8.45866 2.86654 8.43262 2.80469C8.40658 2.74512 8.37077 2.69303 8.3252 2.64844C8.28223 2.60286 8.22982 2.56706 8.16797 2.54102C8.10807 2.51497 8.04395 2.50195 7.97559 2.50195H1.52441C1.45605 2.50195 1.39095 2.51497 1.3291 2.54102C1.26953 2.56706 1.21745 2.60286 1.17285 2.64844C1.12728 2.69303 1.09147 2.74512 1.06543 2.80469C1.03939 2.86654 1.02637 2.93164 1.02637 3V9.50098C1.02637 9.56934 1.03939 9.63444 1.06543 9.69629C1.09147 9.75749 1.12728 9.80957 1.17285 9.85254C1.21745 9.89811 1.26953 9.93392 1.3291 9.95996C1.39095 9.98599 1.45605 9.99902 1.52441 9.99902H7.97559Z"
        fill="currentColor"
        fillOpacity="0.8956"
      />
    </svg>
  ),
  closeWin: (props: JSX.IntrinsicAttributes & SVGProps<SVGSVGElement>) => (
    <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <title>Close Window</title>
      <path
        d="M5 5.70898L0.854492 9.85449C0.756836 9.95215 0.639648 10.001 0.50293 10.001C0.359701 10.001 0.239258 9.95378 0.141602 9.85938C0.0472005 9.76172 0 9.64128 0 9.49805C0 9.36133 0.0488281 9.24414 0.146484 9.14648L4.29199 5.00098L0.146484 0.855469C0.0488281 0.757812 0 0.638997 0 0.499023C0 0.430664 0.0130208 0.36556 0.0390625 0.303711C0.0651042 0.241862 0.100911 0.189779 0.146484 0.147461C0.192057 0.101888 0.245768 0.0660807 0.307617 0.0400391C0.369466 0.0139974 0.43457 0.000976562 0.50293 0.000976562C0.639648 0.000976562 0.756836 0.0498047 0.854492 0.147461L5 4.29297L9.14551 0.147461C9.24316 0.0498047 9.36198 0.000976562 9.50195 0.000976562C9.57031 0.000976562 9.63379 0.0139974 9.69238 0.0400391C9.75423 0.0660807 9.80794 0.101888 9.85352 0.147461C9.89909 0.193034 9.9349 0.246745 9.96094 0.308594C9.98698 0.367188 10 0.430664 10 0.499023C10 0.638997 9.95117 0.757812 9.85352 0.855469L5.70801 5.00098L9.85352 9.14648C9.95117 9.24414 10 9.36133 10 9.49805C10 9.56641 9.98698 9.63151 9.96094 9.69336C9.9349 9.75521 9.89909 9.80892 9.85352 9.85449C9.8112 9.90007 9.75911 9.93587 9.69727 9.96191C9.63542 9.98796 9.57031 10.001 9.50195 10.001C9.36198 10.001 9.24316 9.95215 9.14551 9.85449L5 5.70898Z"
        fill="currentColor"
        fillOpacity="0.8956"
      />
    </svg>
  ),
};

export function WindowControls({ dataTauriDragRegion }: { dataTauriDragRegion?: boolean }) {
  const [maximized, setMaximized] = useState<boolean>(false);

  useEffect(() => {
    if (!appWindow) return;
    void appWindow.isMaximized().then((v) => setMaximized(v));
  }, []);

  if (!appWindow) return null;

  return (
    <Center h="30" mr="xs" data-tauri-drag-region={dataTauriDragRegion ? true : undefined}>
      <Group gap="5px" data-tauri-drag-region={dataTauriDragRegion ? true : undefined}>
        <ActionIcon h={25} w={25} radius="lg" onClick={() => appWindow.minimize()} className={classes.icon}>
          <Icons.minimizeWin />
        </ActionIcon>
        <ActionIcon
          h={25}
          w={25}
          radius="lg"
          onClick={() => {
            void appWindow.toggleMaximize();
            setMaximized((prev) => !prev);
          }}
          className={classes.icon}
        >
          {maximized ? <Icons.maximizeRestoreWin /> : <Icons.maximizeWin />}
        </ActionIcon>
        <ActionIcon h={25} w={25} radius="lg" onClick={() => appWindow.close()} className={classes.icon}>
          <Icons.closeWin />
        </ActionIcon>
      </Group>
    </Center>
  );
}
